<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="AALC Affinity Bingo - Connect & Discover">
    <meta name="theme-color" content="#c41e3a">
    <meta name="color-scheme" content="light dark">
    
    <title>AALC Affinity Bingo</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect fill='%23c41e3a' width='100' height='100'/%3E%3Ctext x='50' y='60' font-size='70' font-weight='bold' fill='white' text-anchor='middle'%3EB%3C/text%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 180 180'%3E%3Crect fill='%23c41e3a' width='180' height='180'/%3E%3Ctext x='90' y='120' font-size='120' font-weight='bold' fill='white' text-anchor='middle'%3EB%3C/text%3E%3C/svg%3E">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app" class="app">
        <!-- Loading Screen -->
        <div id="loadingScreen" class="screen loading-screen">
            <div class="loading-container">
                <div class="loading-logo">B</div>
                <h1>AALC Affinity Bingo</h1>
                <p class="subtitle">Connect & Discover</p>
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- Accessibility Settings Screen -->
        <div id="a11yScreen" class="screen a11y-screen hidden">
            <div class="modal-content">
                <h2>Accessibility Preferences</h2>
                <p>Customize your experience:</p>
                
                <label class="checkbox-label">
                    <input type="checkbox" id="highContrastToggle" aria-label="Enable high contrast mode">
                    <span>High Contrast Mode</span>
                </label>
                
                <label class="checkbox-label">
                    <input type="checkbox" id="largeFontToggle" aria-label="Enable large text">
                    <span>Large Text</span>
                </label>
                
                <label class="checkbox-label">
                    <input type="checkbox" id="reduceMotionToggle" aria-label="Reduce motion">
                    <span>Reduce Motion</span>
                </label>
                
                <button id="continueA11yBtn" class="btn btn-primary" aria-label="Continue to bingo card">
                    Continue
                </button>
            </div>
        </div>

        <!-- Main Bingo Card Screen -->
        <div id="bingoScreen" class="screen bingo-screen hidden">
            <header class="header">
                <div class="header-left">
                    <h1>AALC Bingo</h1>
                </div>
                <div class="header-right">
                    <div id="timerDisplay" class="timer-display hidden" aria-live="polite" aria-label="Round timer">
                        <span id="timerTime">--:--</span>
                    </div>
                    <button id="helpBtn" class="icon-btn" aria-label="Help and instructions" title="Help">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <path d="M12 16v-4M12 8h.01"></path>
                        </svg>
                    </button>
                </div>
            </header>

            <main class="main-content">
                <div class="progress-bar">
                    <div id="progressFill" class="progress-fill"></div>
                </div>
                <p id="progressText" class="progress-text" aria-live="polite">Marked 0/24</p>

                <div id="bingoGrid" class="bingo-grid" role="grid" aria-label="Bingo card grid">
                    <!-- Grid cells will be generated by JavaScript -->
                </div>

                <div class="action-buttons">
                    <button id="summaryBtn" class="btn btn-secondary" aria-label="View your game summary">
                        View Summary
                    </button>
                    <button id="settingsBtn" class="icon-btn" aria-label="Settings" title="Settings">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m3.08 3.08l4.24 4.24M1 12h6m6 0h6m-15.78 7.78l4.24-4.24m3.08-3.08l4.24-4.24"></path>
                        </svg>
                    </button>
                </div>
            </main>
        </div>

        <!-- Bingo Cell Detail Modal -->
        <div id="cellModal" class="modal hidden">
            <div class="modal-content">
                <button class="modal-close" aria-label="Close modal">&times;</button>
                <h2 id="cellPrompt">Prompt goes here</h2>
                <label for="cellNameInput" class="form-label">Who matched this?</label>
                <input
                    id="cellNameInput"
                    type="text"
                    placeholder="Optional: enter name or initials"
                    maxlength="30"
                    aria-label="Name of person who matched this prompt"
                >
                <div class="modal-buttons">
                    <button id="cellCancelBtn" class="btn btn-secondary" aria-label="Cancel">
                        Cancel
                    </button>
                    <button id="cellConfirmBtn" class="btn btn-primary" aria-label="Confirm and mark square">
                        Mark Square
                    </button>
                </div>
            </div>
        </div>

        <!-- Summary Screen -->
        <div id="summaryScreen" class="screen summary-screen hidden">
            <header class="header">
                <button id="backBtn" class="icon-btn" aria-label="Back to bingo card" title="Back">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h2>Your Game Summary</h2>
                <div style="width: 44px;"></div>
            </header>

            <main class="main-content">
                <div class="summary-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="statMarked">0</div>
                        <div class="stat-label">Squares Marked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statBingos">0</div>
                        <div class="stat-label">BINGOS</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statNames">0</div>
                        <div class="stat-label">Names Captured</div>
                    </div>
                </div>

                <div class="summary-section">
                    <h3>Next Step</h3>
                    <p class="summary-info">
                        We'd love to hear about your experience. This takes just 2–3 minutes.
                    </p>
                    <button id="pulseBtn" class="btn btn-primary" aria-label="Start belonging pulse survey">
                        Start Belonging Pulse
                    </button>
                </div>

                <div class="summary-section">
                    <h3>Privacy & Data</h3>
                    <p class="summary-info">
                        ✓ All your data stays on this device. No information is sent anywhere.
                    </p>
                    <button id="resetBtn" class="btn btn-secondary" aria-label="Reset and start over">
                        Reset Card
                    </button>
                </div>
            </main>
        </div>

        <!-- Belonging Pulse Screen -->
        <div id="pulseScreen" class="screen pulse-screen hidden">
            <header class="header">
                <button id="pulsBackBtn" class="icon-btn" aria-label="Back to summary" title="Back">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M19 12H5M12 19l-7-7 7-7"/>
                    </svg>
                </button>
                <h2>Belonging Pulse</h2>
                <div style="width: 44px;"></div>
            </header>

            <main class="main-content pulse-content">
                <div class="pulse-intro">
                    <p>Thank you for playing! We'd love to hear how you felt.</p>
                    <p class="text-muted">All answers stay on your device. They're just for you.</p>
                </div>

                <form id="pulseForm">
                    <!-- Question 1 -->
                    <div class="pulse-question">
                        <label for="q1" class="pulse-label">
                            I felt a sense of belonging during this event.
                        </label>
                        <div class="likert-scale" role="radiogroup" aria-labelledby="q1-label">
                            <label class="radio-label">
                                <input type="radio" name="q1_belonging" value="1" aria-label="Strongly disagree">
                                <span>Strongly<br>Disagree</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="q1_belonging" value="2" aria-label="Disagree">
                                <span>Disagree</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="q1_belonging" value="3" aria-label="Neutral">
                                <span>Neutral</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="q1_belonging" value="4" aria-label="Agree">
                                <span>Agree</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="q1_belonging" value="5" aria-label="Strongly agree">
                                <span>Strongly<br>Agree</span>
                            </label>
                        </div>
                    </div>

                    <!-- Question 2 -->
                    <div class="pulse-question">
                        <label class="pulse-label">
                            I made at least one new connection I intend to follow up with.
                        </label>
                        <div class="yes-no-group" role="radiogroup">
                            <label class="radio-label yes-no">
                                <input type="radio" name="q2_connection" value="true" aria-label="Yes">
                                <span>Yes</span>
                            </label>
                            <label class="radio-label yes-no">
                                <input type="radio" name="q2_connection" value="false" aria-label="No">
                                <span>No</span>
                            </label>
                        </div>
                    </div>

                    <!-- Question 3 -->
                    <div class="pulse-question">
                        <label for="q3_comment" class="pulse-label">
                            (Optional) One thing that made you feel included?
                        </label>
                        <textarea
                            id="q3_comment"
                            name="q3_inclusion_comment"
                            placeholder="Share your thoughts..."
                            maxlength="200"
                            aria-label="Optional comment about what made you feel included"
                        ></textarea>
                        <div class="char-count">
                            <span id="charCount">0</span>/200
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary" aria-label="Submit pulse response">
                        Submit
                    </button>
                </form>

                <div id="pulseThankYou" class="thank-you hidden">
                    <div class="thank-you-content">
                        <div class="thank-you-icon">✨</div>
                        <h3>Thank you!</h3>
                        <p>Your feedback has been saved.</p>
                        <button id="newCardBtn" class="btn btn-primary" aria-label="Start a new card">
                            New Card
                        </button>
                    </div>
                </div>
            </main>
        </div>

        <!-- Help Modal -->
        <div id="helpModal" class="modal hidden">
            <div class="modal-content modal-large">
                <button class="modal-close" aria-label="Close help">&times;</button>
                <h2>How to Play</h2>
                <div class="help-content">
                    <h3>The Rules</h3>
                    <ol>
                        <li><strong>Tap a square</strong> if you meet someone who matches that prompt.</li>
                        <li><strong>Add their name</strong> (optional) to remember who you met.</li>
                        <li><strong>Get BINGO</strong> by marking 5 in a row (horizontal, vertical, or diagonal).</li>
                        <li><strong>Keep playing</strong> for multiple BINGOs!</li>
                    </ol>

                    <h3>Accessibility</h3>
                    <ul>
                        <li>Use <strong>Tab</strong> to navigate between squares.</li>
                        <li>Press <strong>Enter</strong> to open a square's details.</li>
                        <li>Enable High Contrast or Large Text in Settings.</li>
                        <li>Screen readers will announce each square and its state.</li>
                    </ul>

                    <h3>Troubleshooting</h3>
                    <ul>
                        <li><strong>Can't scan the QR?</strong> Type this URL: <br>
                            <code id="helpUrl">https://tolu-jnj.github.io/AALC-Year-End/</code>
                        </li>
                        <li><strong>Privacy:</strong> All data stays on your device. No tracking.</li>
                        <li><strong>Issues?</strong> Refresh the page or clear data via Settings.</li>
                    </ul>

                    <h3>About AALC Bingo</h3>
                    <p>
                        This app helps you meet colleagues and discover shared interests. Have fun, be yourself,
                        and enjoy connecting with your peers!
                    </p>
                </div>
                <button class="btn btn-secondary" id="helpCloseBtn" aria-label="Close help dialog">
                    Close
                </button>
            </div>
        </div>

        <!-- Settings Modal -->
        <div id="settingsModal" class="modal hidden">
            <div class="modal-content">
                <button class="modal-close" aria-label="Close settings">&times;</button>
                <h2>Settings</h2>

                <div class="settings-section">
                    <h3>Accessibility</h3>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settingsHighContrast" aria-label="Toggle high contrast mode">
                        <span>High Contrast</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settingsLargeFont" aria-label="Toggle large text">
                        <span>Large Text</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="settingsReduceMotion" aria-label="Toggle motion reduction">
                        <span>Reduce Motion</span>
                    </label>
                </div>

                <div class="settings-section">
                    <h3>Data & Privacy</h3>
                    <p class="settings-note">Your data stays on this device. No tracking. No remote storage.</p>
                    <button id="exportBtn" class="btn btn-secondary" aria-label="Export summary as QR or text">
                        Export Summary (QR)
                    </button>
                    <button id="clearDataBtn" class="btn btn-danger" aria-label="Clear all local data">
                        Clear All Data
                    </button>
                </div>

                <div class="settings-section">
                    <h3>Host Mode</h3>
                    <p class="settings-note">Facilitators can use this to control the event timer and announcements.</p>
                    <button id="enableHostBtn" class="btn btn-secondary" aria-label="Enable host mode">
                        Enable Host Mode
                    </button>
                </div>

                <button class="btn btn-primary" id="settingsCloseBtn" aria-label="Close settings">
                    Done
                </button>
            </div>
        </div>

        <!-- Host Mode Panel -->
        <div id="hostPanel" class="host-panel hidden">
            <div class="host-header">
                <h3>Host Mode</h3>
                <button id="closeHostBtn" class="icon-btn" aria-label="Close host panel" title="Close">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"></path>
                    </svg>
                </button>
            </div>

            <div class="host-controls">
                <div class="control-group">
                    <label for="roundSelect" class="control-label">Round:</label>
                    <select id="roundSelect" aria-label="Select round number">
                        <option value="1">Round 1 (10 min)</option>
                        <option value="2">Round 2 (10 min)</option>
                        <option value="3">Round 3 (10 min)</option>
                    </select>
                </div>

                <div class="timer-controls">
                    <button id="startTimerBtn" class="btn btn-secondary" aria-label="Start timer">
                        Start Timer
                    </button>
                    <button id="pauseTimerBtn" class="btn btn-secondary hidden" aria-label="Pause timer">
                        Pause
                    </button>
                    <button id="resetTimerBtn" class="btn btn-secondary" aria-label="Reset timer">
                        Reset
                    </button>
                </div>

                <div class="announcement-section">
                    <button id="announcement1Btn" class="btn btn-sm" aria-label="Show announcement: share your win">
                        Announcement 1
                    </button>
                    <button id="announcement2Btn" class="btn btn-sm" aria-label="Show announcement: rotate tables">
                        Announcement 2
                    </button>
                    <button id="announcement3Btn" class="btn btn-sm" aria-label="Show announcement: final call">
                        Announcement 3
                    </button>
                </div>
            </div>
        </div>

        <!-- Announcement Overlay -->
        <div id="announcementOverlay" class="announcement-overlay hidden">
            <div class="announcement-box">
                <p id="announcementText">Announcement</p>
                <button id="announcementCloseBtn" class="btn btn-secondary" aria-label="Close announcement">
                    Got it
                </button>
            </div>
        </div>

        <!-- Export QR Modal -->
        <div id="exportModal" class="modal hidden">
            <div class="modal-content">
                <button class="modal-close" aria-label="Close export dialog">&times;</button>
                <h2>Export Summary</h2>
                <p class="modal-note">
                    This QR contains only counts (no names). Facilitators can scan this to aggregate results.
                </p>
                <div id="qrContainer" class="qr-container">
                    <!-- QR will be generated here -->
                </div>
                <div class="export-buttons">
                    <button id="copyQrBtn" class="btn btn-secondary" aria-label="Copy QR as text">
                        Copy as Text
                    </button>
                    <button id="exportCloseBtn" class="btn btn-primary" aria-label="Close export dialog">
                        Done
                    </button>
                </div>
            </div>
        </div>

        <!-- Confetti (for celebrations) -->
        <canvas id="confettiCanvas" class="confetti-canvas hidden"></canvas>
    </div>

    <script src="prompts.js"></script>
    <script src="app.js"></script>

    <script>
        // Register Service Worker for PWA support
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('sw.js').catch(err => {
                console.log('Service Worker registration failed:', err);
            });
        }
    </script>
</body>
</html>
